-- Expected URL ‡∏Ç‡∏≠‡∏á main script
local EXPECTED_URL = "https://raw.githubusercontent.com/SunOpenGL/5dax1/refs/heads/main/2x4"

-- ‡πÄ‡∏Å‡πá‡∏ö function ‡∏à‡∏£‡∏¥‡∏á‡πÑ‡∏ß‡πâ
local _HttpGet = game.HttpGet
local _HttpGetAsync = game.HttpGetAsync
local _http_request = rawget(getgenv(), "http_request")
local _request = rawget(getgenv(), "request")

-- ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô http_request / request spy
if _http_request then
    getgenv().http_request = newcclosure(function(args)
        if typeof(args) == "table" and args.Url and args.Url:match("127.0.0.1:6463") then
            return warn("üö´ Blocked Discord RPC request")
        end
        return _http_request(args)
    end)
end

if _request then
    getgenv().request = newcclosure(function(args)
        if typeof(args) == "table" and args.Url and args.Url:match("127.0.0.1:6463") then
            return warn("üö´ Blocked Discord RPC request")
        end
        return _request(args)
    end)
end

local _HttpGet = game.HttpGet
local _HttpGetAsync = game.HttpGetAsync

-- hook ‡πÉ‡∏´‡∏°‡πà
hookfunction(game.HttpGet, newcclosure(function(self, url, ...)
    if url and url:match("127.0.0.1:6463") then
        return warn("üö´ Blocked suspicious HttpGet:", url)
    end
    return _HttpGet(self, url, ...)
end))

hookfunction(game.HttpGetAsync, newcclosure(function(self, url, ...)
    if url and url:match("127.0.0.1:6463") then
        return warn("üö´ Blocked suspicious HttpGetAsync:", url)
    end
    return _HttpGetAsync(self, url, ...)
end))

-- Key Validation
local validateKeySystem = newcclosure(function()
    if not getgenv().SOMTANK_KEY then
        return warn("‚ùå Unauthorized! Must pass key system first.")
    end

    local info = rawget(getgenv(), "_SomtankMarker")
    if type(info) ~= "table"
        or info.url ~= "Somtank_Huntyzombie"
        or typeof(info.token) ~= "Instance"
        or info.sourceUrl ~= EXPECTED_URL then
        return warn("‚ùå Invalid loader info or unauthorized source!")
    end

    -- clear marker ‡∏´‡∏•‡∏±‡∏á validate
    pcall(function()
        getgenv()._SomtankMarker = nil
        getgenv().SOMTANK_KEY = false
    end)

    print("‚úÖ Main script loaded successfully from:", EXPECTED_URL)
end)

validateKeySystem()
