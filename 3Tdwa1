
-- =====================================================
-- SERVICES
-- =====================================================
local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local CoreGui = game:GetService("CoreGui")
local GuiService = game:GetService("GuiService")

local player = Players.LocalPlayer

-- =====================================================
-- GLOBAL STATE (PERSIST)
-- =====================================================
getgenv().AUTO_REJOIN = getgenv().AUTO_REJOIN or false

local TARGET_PLACE = 129009554587176
local BAIT_PLACE   = 76558904092080

-- =====================================================
-- QUEUE HANDLER (RE-QUEUE SAFE)
-- =====================================================
local function queueCheck()
    queueonteleport([[
        repeat task.wait(0.5) until game:IsLoaded()

        local TARGET_PLACE = 129009554587176
        local BAIT_PLACE   = 76558904092080

        print("üîÅ [QUEUE] Loaded")
        print("üìç PlaceId:", game.PlaceId)
        print("‚ôª AUTO_REJOIN:", tostring(getgenv().AUTO_REJOIN))

        -- ‡∏ñ‡πâ‡∏≤‡∏°‡∏≤ World 1 ‚Üí ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡∏ö ‚Üí queue ‡∏ï‡πà‡∏≠
        if game.PlaceId == BAIT_PLACE then
            print("üåÄ ‡∏≠‡∏¢‡∏π‡πà World 1 (bait) ‚Üí queue ‡∏£‡∏≠‡∏£‡∏≠‡∏ö‡∏ñ‡∏±‡∏î‡πÑ‡∏õ")
            queueonteleport(game:HttpGet("https://raw.githubusercontent.com/SunOpenGL/5dax1/refs/heads/main/3Tdwa1")) -- ‡∏î‡∏π‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á
            return
        end

        -- ‡∏ñ‡πâ‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡πÇ‡∏•‡∏Å‡∏à‡∏£‡∏¥‡∏á
        if game.PlaceId == TARGET_PLACE then
            print("‚úÖ Rejoin ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤ World 2 ‡πÅ‡∏•‡πâ‡∏ß")
            getgenv().AUTO_REJOIN = false
        end
    ]])
end

-- =====================================================
-- REJOIN FUNCTION
-- =====================================================
local function forceRejoin()
    if getgenv().AUTO_REJOIN then return end

    getgenv().AUTO_REJOIN = true
    print("üîÑ Force Rejoin ‚Üí Teleport ‡πÑ‡∏õ World 1")

    queueCheck()
    TeleportService:Teleport(BAIT_PLACE, player)
end

-- =====================================================
-- ERROR / KICK DETECT
-- =====================================================
pcall(function()
    CoreGui.RobloxPromptGui.promptOverlay.ChildAdded:Connect(function(child)
        if child.Name == "ErrorPrompt" or child.Name == "KickPrompt" then
            warn("‚ö†Ô∏è Error / Kick detected")
            forceRejoin()
        end
    end)
end)

GuiService.ErrorMessageChanged:Connect(function()
    warn("‚ö†Ô∏è ErrorMessageChanged detected")
    forceRejoin()
end)

-- =====================================================
-- ENTRY
-- =====================================================
repeat task.wait() until game:IsLoaded()
print("üåç Game Loaded:", game.PlaceId)

if game.PlaceId ~= TARGET_PLACE then
    getgenv().AUTO_REJOIN = true
    queueCheck()
end
